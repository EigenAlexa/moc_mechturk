<template name="experiment">
    <div class="col-md-12">
        {{> coinTable}}
    </div>

    <hr>

    <div class="container">
        {{#if allGuessed}}
            {{> userTable}}
        {{else}}
            {{> controller}}
        {{/if}}
    </div>

    <hr>

    {{> testForm}}

    <!--<h1>Data</h1>
      <h3>Public Data:</h3>
      <div class="col-md-12">
        <div class="alert alert-info">
        <p>{{#each games gameId}} {{publicData}} {{/each}}
        </p>
        </div>
      </div>

      <hr/>

      <h3>Private Data for {{currentUser.username}}:</h3>
      <div class="col-md-12">
        <div class="alert alert-info">
        <p>{{#each players currentUser._id}} {{privateData}} {{/each}}</p>
        </div>
      </div>-->
</template>

<template name="coinTable">
    <div class="flex-equal-horz">
    {{#each opponents}}
    <div>
        <img src='img/ppl-{{imageHash}}.jpg' class="centered">
        <h3 class="centered">{{oppName}} ({{numPrivate}} flips)</h3>
    </div>
    {{/each}}
    </div>

    <div class="public-board">
        <img src='img/table.png' class="centered">
        <h3 class="public-info">Public: {{> displayFlips publicFlips}}</h3>
    </div>

    <div class="private-board">
        <h3 class="centered">Private: {{> displayFlips privateFlips}}</h3>
    </div>

</template>

<template name="displayFlips">
    {{ flipSeq }} ( {{heads}} heads / {{total}} coins )
</template>

<template name="controller">
    <div class="controller">
        {{#if delphiActive}}
            {{#if iGuessedDelphi }}
                You guessed: <b>{{ myDelphi }}</b>
                <br>
                <b class="text-warning">Waiting for others to submit their
                    initial guess.</b>
            {{else}}
                <b class="text-danger">This is a preliminary round. You get
                    a chance to change your guess afterward.
                </b>
                {{> guessForm}}
            {{/if}}
        {{else}}
            {{#if iGuessed}}
                You guessed: <b>{{ myAnswer }}</b>
                <br>
                <b class="text-warning">Waiting for others.</b>
            {{else}}
                {{#if delphiGame}}
                {{> delphiDisplay}}
                {{/if}}
                {{> guessForm}}
            {{/if}}
        {{/if}}
    </div>
</template>

<template name="delphiDisplay">
    <p><b>Here's what everyone thinks so far:</b></p>
    <svg width="500" height="100">
        <g transform="translate(250,20)">
            <line class="number-line" x1="-200" x2="200" y1="0" y2="0"></line>
            {{#each guesses}}
                <circle cx={{x}} cy="0" r="8"></circle>
                <line class="dotted-line" x1={{x}} x2={{x}} y1="0"
                      y2={{y @index}}></line>
                <text x={{x}} y={{y @index}} dy="1em"
                      text-anchor="middle">{{displayValue}}</text>
            {{/each}}
        </g>
    </svg>
    <p>You can now change your guess if you would like.</p>
</template>

<template name="guessForm">
    <form name="guessForm" class="guess">
        <h4>If this coin is flipped 100 more times, how many times will it
            come up heads?</h4>
        <br/>
        <input id="guess-slider" name="slider" type="range" min="0" max="100" step="1">
        <h3><span>{{guessValue}} heads</span></h3>
        <br/>
        <input type="submit" class="btn btn-info btn-lg">
    </form>
</template>

<template name="guessSlider">

</template>

<template name="userTable">
    <h3>Actual probability was: {{prob}}</h3>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>User</th>
            <th>Guess</th>
            <th>Last Payoff</th>
            <th>Total Payoff</th>
        </tr>
        </thead>
        <tbody>
        {{#each guesses}}
            <tr>
                <td>{{username}}</td>
                <td>{{answer}}</td>
                <td>{{payoff}}</td>
                <td>{{total}}</td>
            </tr>
        {{/each}}
        </tbody>
    </table>
</template>
