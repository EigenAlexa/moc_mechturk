<template name="experiment">
    <div class="col-md-12">
        {{> gameInstructions}}
    </div>

    <div class="col-md-12">
        {{> coinTable}}
    </div>

    <hr>

    <div class="col-md-12">
        {{#if allGuessed}}
            {{> userTable}}
        {{else}}
            {{> controller}}
        {{/if}}
    </div>

    <hr>

    {{> testForm}}

    <!--<h1>Data</h1>
      <h3>Public Data:</h3>
      <div class="col-md-12">
        <div class="alert alert-info">
        <p>{{#each games gameId}} {{publicData}} {{/each}}
        </p>
        </div>
      </div>

      <hr/>

      <h3>Private Data for {{currentUser.username}}:</h3>
      <div class="col-md-12">
        <div class="alert alert-info">
        <p>{{#each players currentUser._id}} {{privateData}} {{/each}}</p>
        </div>
      </div>-->
</template>

<template name="coinTable">
    <div class="flex-equal-horz">
    {{#each opponents}}
    <div>
        <img src='img/ppl-{{imageHash}}.jpg' class="centered">
        <h3 class="centered">{{oppName}}</h3>
	<h3>({{numPrivate}} private flips)</h3>
	<h3> 
	  {{#if oppoGuessed}}
	  Guess submitted
	  {{else}}
	  Guess not submitted yet
	  {{/if}}
	</h3>
    </div>
    {{/each}}
    </div>


    <div class="public-board">
        <!--img src='img/table.png' class="centered" -->
        <h3 class="public-info">Public flips: {{> displayFlips publicFlips}}</h3>
    </div>

    <div class="private-board">
        <h3 class="centered">Your private flips: {{> displayFlips privateFlips}}</h3>
    </div>

</template>

<template name="displayFlips">
    {{heads}} heads / {{total}} flips ( {{ flipSeq }} )
</template>

<template name="controller">
    <div class="controller">
        {{#if delphiActive}}
            {{#if iGuessedDelphi }}
                <h3>You guessed: <b>{{ myDelphi }}</b></h3>
                <br>
                <b class="text-warning">Round 1: Waiting for others to submit their
                    initial guesses.</b>
            {{else}}
                <b class="text-danger">Round 1: Please enter your initial guess.  You will have
                    a chance to change your guess afterward.
                </b>
                {{> guessForm}}
            {{/if}}
        {{else}}
            {{#if iGuessed}}
                <h3>You guessed: <b>{{ myAnswer }}</b></h3>
                <br>
                <b class="text-warning">Waiting for others.</b>
            {{else}}
                {{#if delphiGame}}
                {{> delphiDisplay}}
                {{/if}}
                {{> guessForm}}
            {{/if}}
        {{/if}}
    </div>
</template>

<template name="delphiDisplay">
    <p><b>Here's what everyone thinks so far:</b></p>
    <svg width="500" height="100">
        <g transform="translate(250,20)">
            <line class="number-line" x1="-200" x2="200" y1="0" y2="0"></line>
            {{#each guesses}}
                <circle cx={{x}} cy="0" r="8"></circle>
                <line class="dotted-line" x1={{x}} x2={{x}} y1="0"
                      y2={{y @index}}></line>
                <text x={{x}} y={{y @index}} dy="1em"
                      text-anchor="middle">{{displayValue}}</text>
            {{/each}}
        </g>
    </svg>
    <p>Please change your guess if you like.</p>
</template>

<template name="guessForm">
    <form name="guessForm" class="guess">
        <h4>If this coin is flipped 100 more times, how many times will it
            come up heads?</h4>
        <br/>
        <input id="guess-slider" name="slider" type="range" min="0" max="100" step="1">
        <h3><span>{{guessValue}} heads</span></h3>
        <br/>
        <input type="submit" class="btn btn-info btn-lg">
    </form>
</template>

<template name="guessSlider">

</template>

<template name="userTable">
    <h3># of heads in 100 new flips is: {{prob}}</h3>
    <h3>
      
        {{#if isCollInc}}
            Average guess: {{ avgGuess }}
        {{else}}
            Your guess: {{ myAnswer }}
        {{/if}}
    </h3>
    <h3>      
      {{# if isCompInc}}
        {{# if myWinStatus }}
          Congratulations, you won!
        {{else}}
          You did not win.
        {{/if}}
        You earned a bonus of ${{ myPayoff }}
      {{else}}
        You earned a bonus of ${{ myPayoff }}
      {{/if}}
    </h3>
    <!--table class="table table-striped">
        <thead>
        <tr>
            <th>User</th>
            <th>Guess</th>
            <th>Last Payoff</th>
            <th>Total Payoff</th>
        </tr>
        </thead>
        <tbody>
        {{#each guesses}}
            <tr>
                <td>{{username}}</td>
                <td>{{answer}}</td>
                <td>{{payoff}}</td>
                <td>{{total}}</td>
            </tr>
        {{/each}}
        </tbody>
    </table-->
</template>
